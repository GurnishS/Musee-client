import 'package:equatable/equatable.dart';
import 'package:musee/features/player/domain/entities/queue_item.dart';

class PlayerTrack extends Equatable {
  final String? trackId; // nullable when playing ad-hoc URL not from queue
  final String url;
  final String title;
  final String artist;
  final String? album;
  final String? imageUrl;
  final Map<String, String>? headers;

  const PlayerTrack({
    this.trackId,
    required this.url,
    required this.title,
    required this.artist,
    this.album,
    this.imageUrl,
    this.headers,
  });

  PlayerTrack copyWith({
    String? trackId,
    String? url,
    String? title,
    String? artist,
    String? album,
    String? imageUrl,
    Map<String, String>? headers,
  }) => PlayerTrack(
    trackId: trackId ?? this.trackId,
    url: url ?? this.url,
    title: title ?? this.title,
    artist: artist ?? this.artist,
    album: album ?? this.album,
    imageUrl: imageUrl ?? this.imageUrl,
    headers: headers ?? this.headers,
  );

  @override
  List<Object?> get props => [trackId, url, title, artist, album, imageUrl, headers];
}

class PlayerViewState extends Equatable {
  final PlayerTrack? track;
  final bool playing;
  final bool buffering;
  final Duration position;
  final Duration duration;
  final double volume;
  final List<QueueItem> queue;
  final int currentIndex; // index within queue for currently playing track

  const PlayerViewState({
    this.track,
    this.playing = false,
    this.buffering = false,
    this.position = Duration.zero,
    this.duration = Duration.zero,
    this.volume = 1.0,
    this.queue = const <QueueItem>[],
    this.currentIndex = -1,
  });

  PlayerViewState copyWith({
    PlayerTrack? track,
    bool? playing,
    bool? buffering,
    Duration? position,
    Duration? duration,
    double? volume,
    List<QueueItem>? queue,
    int? currentIndex,
  }) {
    return PlayerViewState(
      track: track ?? this.track,
      playing: playing ?? this.playing,
      buffering: buffering ?? this.buffering,
      position: position ?? this.position,
      duration: duration ?? this.duration,
      volume: volume ?? this.volume,
      queue: queue ?? this.queue,
      currentIndex: currentIndex ?? this.currentIndex,
    );
  }

  @override
  List<Object?> get props => [
    track,
    playing,
    buffering,
    position,
    duration,
    volume,
    queue,
    currentIndex,
  ];
}
